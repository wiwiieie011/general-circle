API Gateway — JWT Middleware для платформы организации мероприятий

Кратко
- Платформа: организация и управление мероприятиями (пользователи, события, билеты, уведомления).
- Этот модуль: API Gateway на базе Gin с проверкой JWT и проксированием запросов к внутренним сервисам.
- Основная логика авторизации реализована в [gateway/middleware/jwt.go](gateway/middleware/jwt.go).

Идея
API-шлюз принимает внешние HTTP-запросы, проверяет токен доступа (Bearer JWT) и, если он валиден, добавляет служебные заголовки `X-User-Id` и `X-User-Role`, после чего безопасно проксирует запрос к нужному внутреннему сервису (пользователи, билеты, события, уведомления).

Технологии (по коду middleware)
- Язык: Go
- Веб-фреймворк: Gin (`github.com/gin-gonic/gin`)
- Аутентификация: JWT (через внутренний пакет `gateway/jwtutil`, использующий `github.com/golang-jwt/jwt/v5`)
- Стандартная библиотека Go: `net/http`, `strings`, `strconv`

Как работает JWT middleware
1) Читает заголовок `Authorization`.
2) Проверяет формат: `Authorization: Bearer <token>`.
3) Валидирует токен и извлекает клеймы (`user_id`, `role`, `type=access`).
4) Пробрасывает идентификатор и роль пользователя в заголовках `X-User-Id` и `X-User-Role` для downstream-сервисов.
5) При ошибках возвращает 401 и JSON:
   - `{"error": "missing authorization header"}`
   - `{"error": "invalid authorization format"}`
   - `{"error": "invalid token"}`

Быстрый старт
Предусловия
- Go (совместимая с `go.mod` версия)
- Переменная окружения `JWT_SECRET` — секрет для проверки подписи токенов

Установка и запуск (gateway)
1) Установить зависимости:
   go mod download
2) Задать секрет JWT (пример для PowerShell):
   $env:JWT_SECRET = "super_secret"
3) Запустить шлюз из каталога `gateway`:
   go run .

Использование
- В запросах к защищённым маршрутам добавляйте заголовок:
  Authorization: Bearer <JWT>
- После успешной проверки downstream-сервисы получат:
  - `X-User-Id: <числовой идентификатор>`
  - `X-User-Role: <роль>`

Архитектура модуля (в контексте gateway)
- Маршруты аутентификации могут идти без middleware (например, `/api/auth/*`).
- Остальные маршруты проходят через JWT middleware и далее проксируются к внутренним сервисам.